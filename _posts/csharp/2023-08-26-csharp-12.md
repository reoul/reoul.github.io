---
title: "[C#] structì˜ ë©”ëª¨ë¦¬ ë³µì‚¬ ë¹„ìš©"

categories:
  - CSharp
tags:
  - [Memory]

toc: false                         # ëª©ì°¨
toc_sticky: false                  # ëª©ì°¨ ì‚¬ì´ë“œë°” ê³ ì •

published: true                   #ê¸€ ê³µê°œ ì—¬ë¶€

date:       2023-08-26T15:44:00+09:00
lastmod:    2023-08-26T15:44:00+09:00
---

<!-- description : 25ìì—ì„œ 160ì ì‚¬ì´ -->
struct íƒ€ì…ì˜ ë©”ëª¨ë¦¬ ë³µì‚¬ ì„±ëŠ¥ì— ëŒ€í•´ í…ŒìŠ¤íŠ¸í•˜ê³  ì‘ì„±í•œ ê¸€ì´ë‹¤.
{: .notice--warning}

## structì˜ ë©”ëª¨ë¦¬ ë³µì‚¬ ë¹„ìš©

- `struct`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **í¬ê¸°ì™€ ê´€ê³„ì—†ì´** `Stack`ì— í• ë‹¹ëœë‹¤
  - ì¼ì • í¬ê¸° ì´ìƒì¼ ê²½ìš° `Heap`ì— í• ë‹¹ëœë‹¤ëŠ” ì •ë³´ê°€ ìˆì–´ ìœ ë‹ˆí‹°ì—ì„œ 1024kb í¬ê¸°ì˜ `struct`ë¥¼ ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸í•´ ë³¸ ê²°ê³¼ `GC Alloc`ì€ ë°œìƒí•˜ì§€ ì•ŠìŒ
  - ëª‡ëª‡ì˜ ê²½ìš°ëŠ” `Stack`ì— í• ë‹¹ì´ ëœë‹¤. ex) `class`ì˜ ë©¤ë²„ ë³€ìˆ˜ íƒ€ì…ìœ¼ë¡œ ì‚¬ìš©, ì¸ìŠ¤í„´ì‹±ëœ `struct` ê°ì²´ë¥¼ `object`ë¡œ `boxing`í•˜ëŠ” ê²½ìš°, ...
- `Stack`ì— ë©”ëª¨ë¦¬ê°€ í• ë‹¹ëœë‹¤ëŠ” ì˜ë¯¸ëŠ”?
  - `struct` íƒ€ì…ì˜ ë³€ìˆ˜ë¥¼ ì •ì˜í•  ë•Œ `struct` í¬ê¸°ë§Œí¼ ë©”ëª¨ë¦¬ë¥¼ `Stack`ì— ë³µì‚¬í•´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤
  - ì•„ë˜ ì½”ë“œì˜ ì„±ëŠ¥ì„ ì¸¡ì •í–ˆì„ ë•Œ `struct`ì˜ ê²½ìš° í¬ê¸°ê°€ ì‘ìœ¼ë©´ ì„±ëŠ¥ì´ ë¹„ìŠ·í•˜ê²Œ ë‚˜ì˜¤ì§€ë§Œ **í¬ê¸°ê°€ í´ìˆ˜ë¡ ë³µì‚¬ ë¹„ìš©ì´ ëŠ˜ì–´ë‚˜ ì„±ëŠ¥ í•˜ë½**ì´ ë°œìƒí•œë‹¤
  - `class`ì˜ ê²½ìš°ëŠ” í¬ì¸í„° ë°©ì‹ì˜ ì ‘ê·¼ìœ¼ë¯€ë¡œ ë©”ëª¨ë¦¬ ë³µì‚¬ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ í¬ê¸°ì™€ ê´€ê³„ì—†ì´ ì¼ì •í•œ ì„±ëŠ¥ì„ ìœ ì§€í•œë‹¤
  - ê²°ê³¼ì ìœ¼ë¡œ `struct` íƒ€ì…ì˜ í¬ê¸°ê°€ í¬ë©´ `Stack`ì— ë©”ëª¨ë¦¬ë¥¼ ë³µì‚¬í•˜ì§€ ì•Šê³  `Reference` íƒ€ì…ê³¼ ê°™ì´ í¬ì¸í„° ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•´ **ë©”ëª¨ë¦¬ ë³µì‚¬ ë¹„ìš©ì„ ë‚®ì¶°ì•¼ í•œë‹¤**
  - <img src="/assets/images/postImage/2023-08-26-csharp-12-15-38-49.png" style="max-width: 60%; height: auto;" title="2023-08-26-csharp-12-15-38-49.png" alt="2023-08-26-csharp-12-15-38-49.png">
  
## í…ŒìŠ¤íŠ¸ ì½”ë“œ

```c#
public struct LittleStruct
{
    public int int1;
    public int int2;
    public int int3;
}

public struct BigStruct
{
    public long long1;
    public long long2;
    public long long3;
    public long long4;
    public long long5;
    public long long6;
    public long long7;
    public long long8;
    public long long9;
    public long long10;
    public long long11;
    public long long12;
    public long long13;
}

public class LittleClass
{
    public int int1;
    public int int2;
    public int int3;
}

public class BigClass
{
    public long long1;
    public long long2;
    public long long3;
    public long long4;
    public long long5;
    public long long6;
    public long long7;
    public long long8;
    public long long9;
    public long long10;
    public long long11;
    public long long12;
    public long long13;
}

public class PerformanceTest
{
    private static readonly LittleStruct[] LittleStructArr = new LittleStruct[100];
    private static readonly BigStruct[] BigStructArr = new BigStruct[100];

    public static readonly LittleClass[] LittleClassArr = new LittleClass[100];
    public static readonly BigClass[] BigClassArr = new BigClass[100];

    static PerformanceTest()
    {
        for (int i = 0; i < LittleClassArr.Length; i++)
            LittleClassArr[i] = new LittleClass();

        for (int i = 0; i < BigClassArr.Length; i++)
            BigClassArr[i] = new BigClass();

        GC.Collect();
        GC.WaitForPendingFinalizers();
    }

    [Benchmark]
    public void NoCopied_LittleStruct()
    {
        int count = 0;
        for (int i = 0; i < LittleStructArr.Length; ++i)
        {
            if (LittleStructArr[i].int1 == 1)
                ++count;
            if (LittleStructArr[i].int2 == 2)
                ++count;
            if (LittleStructArr[i].int3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void Copied_LittleStruct()
    {
        int count = 0;
        for (int i = 0; i < LittleStructArr.Length; ++i)
        {
            LittleStruct data = LittleStructArr[i];
            if (data.int1 == 1)
                ++count;
            if (data.int2 == 2)
                ++count;
            if (data.int3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void NoCopied_BigStruct()
    {
        int count = 0;
        for (int i = 0; i < BigStructArr.Length; ++i)
        {
            if (BigStructArr[i].long1 == 1)
                ++count;
            if (BigStructArr[i].long2 == 2)
                ++count;
            if (BigStructArr[i].long3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void Copied_BigStruct()
    {
        int count = 0;
        for (int i = 0; i < BigStructArr.Length; ++i)
        {
            BigStruct data = BigStructArr[i];
            if (data.long1 == 1)
                ++count;
            if (data.long2 == 2)
                ++count;
            if (data.long3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void NoCopied_LittleClass()
    {
        int count = 0;
        for (int i = 0; i < LittleClassArr.Length; ++i)
        {
            if (LittleClassArr[i].int1 == 1)
                ++count;
            if (LittleClassArr[i].int2 == 2)
                ++count;
            if (LittleClassArr[i].int3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void Copied_LittleClass()
    {
        int count = 0;
        for (int i = 0; i < LittleClassArr.Length; ++i)
        {
            LittleClass data = LittleClassArr[i];
            if (data.int1 == 1)
                ++count;
            if (data.int2 == 2)
                ++count;
            if (data.int3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void NoCopied_BigClass()
    {
        int count = 0;
        for (int i = 0; i < BigClassArr.Length; ++i)
        {
            if (BigClassArr[i].long1 == 1)
                ++count;
            if (BigClassArr[i].long2 == 2)
                ++count;
            if (BigClassArr[i].long3 == 3)
                ++count;
        }
    }

    [Benchmark]
    public void Copied_BigClass()
    {
        int count = 0;
        for (int i = 0; i < BigClassArr.Length; ++i)
        {
            BigClass data = BigClassArr[i];
            if (data.long1 == 1)
                ++count;
            if (data.long2 == 2)
                ++count;
            if (data.long3 == 3)
                ++count;
        }
    }
}
```



***
<br>

    ğŸ’» ì—´ì‹¬íˆ ê³µë¶€í•´ì„œ ì‘ì„± ì¤‘ì´ë‹ˆ ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
      ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜¸


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}