---
title: "[C#] AttributeUsageAttribute"

categories:
  - CSharp
tags:
  - [Attribute]

toc: true                         # ëª©ì°¨
toc_sticky: true                  # ëª©ì°¨ ì‚¬ì´ë“œë°” ê³ ì •

published: true                   #ê¸€ ê³µê°œ ì—¬ë¶€

date:       2023-09-17T00:00:00+09:00
lastmod:    2023-09-17T00:00:00+09:00
---

<!-- description : 25ìì—ì„œ 160ì ì‚¬ì´ -->
AttributeUsageAttributeì— ëŒ€í•´ ì‚¬ìš© ë° í…ŒìŠ¤íŠ¸í•˜ê³  ì‘ì„±í•œ ê¸€ì´ë‹¤.
{: .notice--warning}

## AttributeUsageAttribute

- `Attribute`ì— ì˜µì…˜ì„ ë¶€ì—¬í•  ìˆ˜ ìˆëŠ” `Attribute`ì´ë‹¤
  - `ValidOn` : Attributeë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **ëŒ€ìƒì„ ì§€ì •**
  - `AllowMultiple` : í•˜ë‚˜ì˜ ìš”ì†Œì— 2ë²ˆ ì´ìƒì˜ `Attribute`ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€
  - `Inherited` : íŒŒìƒ í´ë˜ìŠ¤ë‚˜ ì¬ì •ì˜ ë©¤ë²„ì—ê²Œë„ `Attribute`ê°€ **ìƒì†**ë˜ëŠ”ì§€ ì—¬ë¶€

### ValidOn

- `AttributeTarges`ì„ ì‚¬ìš©í•´ í•´ë‹¹ `Attribute`ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” **ëŒ€ìƒì„ ì œí•œ**í•  ìˆ˜ ìˆë‹¤
  - ex) Class, Field, Property, ...
- ì›ì¹˜ ì•ŠëŠ” ìš”ì†Œê°€ í•´ë‹¹ `Attribute`ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” ê²½ìš°ë¥¼ ë¯¸ë¦¬ ë°©ì§€í•  ìˆ˜ ìˆë‹¤

```c#
[AttributeUsage(AttributeTargets.Class)]
public class ClassAttribute : Attribute
{
}

// ì•„ë˜ì˜ ê²½ìš° ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ
[ClassAttribute]
public struct TestStruct
{
}
```
  
### AllowMultiple

- í•˜ë‚˜ì˜ ìš”ì†Œê°€ í•´ë‹¹ `Attribute`ë¥¼ **2ë²ˆ ì´ìƒ ì§€ì •**í•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€
  - ì‰½ê²Œ ë§í•˜ë©´ <u>í•˜ë‚˜ì˜ ìš”ì†Œì— í•´ë‹¹ Attribute ì •ë³´ê°€ ì—¬ëŸ¬ê°œ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”ê°€</u> ì´ë‹¤
- ê²°ê³¼ (ë² ì´ìŠ¤ì™€ íŒŒìƒ í´ë˜ìŠ¤ ë‘˜ ë‹¤ ê°™ì€ `Attribute`ë¥¼ ì§€ì •í•œ ê²½ìš°)
  - `true`ì¸ ê²½ìš° íŒŒìƒ í´ë˜ìŠ¤ì—ëŠ” ë² ì´ìŠ¤ í´ë˜ìŠ¤ì˜ `Attribute` ì •ë³´ë„ ë‚¨ì•„ ìˆë‹¤
  - `false`ì¸ ê²½ìš° íŒŒìƒ í´ë˜ìŠ¤ì—ëŠ” íŒŒìƒ í´ë˜ìŠ¤ì˜ `Attribute` ì •ë³´ë§Œ ë‚¨ì•„ ìˆë‹¤ (override)

```c#
public class Program
{
    static void Main(string[] args)
    {
        ShowCustomAttributes<DerivedClass, AllowMultipleAttribute>();
        // ê²°ê³¼
        // [AllowMultipleAttribute] DerivedClass
        // [AllowMultipleAttribute] BaseClass_1
        // [AllowMultipleAttribute] BaseClass_2


        ShowCustomAttributes<DerivedClass, DenyMultipleAttribute>();
        // ê²°ê³¼
        // [DenyMultipleAttribute] DerivedClass
    }

    private static void ShowCustomAttributes<TClass, TAttribute>(bool inherit = true)
        where TClass : AttributeClass
        where TAttribute : BaseAttribute
    {
        foreach (var attribute in typeof(TClass).GetCustomAttributes<TAttribute>(inherit))
            attribute.ShowAttributeInfo();
    }
}


public abstract class BaseAttribute : Attribute
{
    public virtual void ShowAttributeInfo() { }
}

[AttributeUsage(AttributeTargets.All, AllowMultiple = true)]
public class AllowMultipleAttribute : BaseAttribute
{
    public string Name { get; set; }

    public override void ShowAttributeInfo()
    {
        Console.WriteLine($"[AllowMultipleAttribute] {Name}");
    }
}

[AttributeUsage(AttributeTargets.All, AllowMultiple = false)]
public class DenyMultipleAttribute : BaseAttribute
{
    public string Name { get; set; }

    public override void ShowAttributeInfo()
    {
        Console.WriteLine($"[DenyMultipleAttribute] {Name}");
    }
}


public abstract class AttributeClass { }

[AllowMultipleAttribute(Name = "BaseClass_1")]
[AllowMultipleAttribute(Name = "BaseClass_2")]
[DenyMultipleAttribute(Name = "BaseClass")]
public class BaseClass : AttributeClass { }

[AllowMultipleAttribute(Name = "DerivedClass")]
[DenyMultipleAttribute(Name = "DerivedClass")]
public class DerivedClass : BaseClass { }
```

### Inherited

- íŒŒìƒ í´ë˜ìŠ¤ë‚˜ ì¬ì •ì˜ ë©¤ë²„ì—ê²Œë„ `Attribute`ê°€ ìƒì†ë˜ëŠ”ì§€ ì—¬ë¶€
- ê²°ê³¼
  - `true`ì¸ ê²½ìš° íŒŒìƒ í´ë˜ìŠ¤ì—ì„œ ë¶€ëª¨ì— ì§€ì •ëœ `Attribute`ë¥¼ ìƒì† ë°›ëŠ”ë‹¤
  - `false`ì¸ ê²½ìš° íŒŒìƒ í´ë˜ìŠ¤ì—ì„œ ë¶€ëª¨ì— ì§€ì •ëœ `Attribute`ë¥¼ ìƒì† ë°›ì§€ ëª» í•œë‹¤

```c#
public class Program
{
    static void Main(string[] args)
    {
        ShowCustomAttributes<DerivedClass, InheritedTrueAttribute>();
        // ê²°ê³¼
        // [InheritedTrueAttribute] BaseClass


        ShowCustomAttributes<DerivedClass, InheritedFalseAttribute>();
        // ê²°ê³¼
        // 
    }

    private static void ShowCustomAttributes<TClass, TAttribute>(bool inherit = true)
        where TClass : AttributeClass
        where TAttribute : BaseAttribute
    {
        foreach (var attribute in typeof(TClass).GetCustomAttributes<TAttribute>(inherit))
            attribute.ShowAttributeInfo();
    }
}


public abstract class BaseAttribute : Attribute
{
    public virtual void ShowAttributeInfo() { }
}

[AttributeUsage(AttributeTargets.All, Inherited = true)]
public class InheritedTrueAttribute : BaseAttribute
{
    public string Name { get; set; }

    public override void ShowAttributeInfo()
    {
        Console.WriteLine($"[InheritedTrueAttribute] {Name}");
    }
}

[AttributeUsage(AttributeTargets.All, Inherited = false)]
public class InheritedFalseAttribute : BaseAttribute
{
    public string Name { get; set; }

    public override void ShowAttributeInfo()
    {
        Console.WriteLine($"[InheritedFalseAttribute] {Name}");
    }
}


public abstract class AttributeClass { }

[InheritedTrueAttribute(Name = "BaseClass")]
[InheritedFalseAttribute(Name = "BaseClass")]
public class BaseClass : AttributeClass { }

public class DerivedClass : BaseClass { }
```

## ë‹¨ìˆœí•œ í˜¸ê¸°ì‹¬

- ë§Œì•½ `BaseAttribute`ì— `AttributeUsageAttribute`ë¥¼ ì§€ì •í•œ í›„ `DerivedAttribute`ì— ìƒì†í•œ ê²½ìš° `AttributeUsageAttribute`ëŠ” `DerivedAttribute`ì— ìƒì†ë ê¹Œ?
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼ `DericedAttribute`ì—ì„œ `AttributeUsageAttribute`ë¥¼ ë‹¤ì‹œ ì§€ì •í•˜ì§€ ì•ŠëŠ” ì´ìƒ `Inherited` ì—¬ë¶€ ìƒê´€ì—†ì´ ë¶€ëª¨ì˜ `AttributeUsageAttribute`ë¥¼ ìƒì† ë°›ëŠ”ë‹¤
  - ë‹¤ë§Œ `ValidOn`ì™€ `AllowMultiple`ë§Œ ìƒì†ë˜ë©° `Inherited`ëŠ” ìƒì†ë˜ì§€ ëª» í•œë‹¤

```c#
[AttributeUsage(AttributeTargets.Struct, AllowMultiple = true, Inherited = false)]
public abstract class BaseAttribute : Attribute { }

public class DerivedAttribute : BaseAttribute { }


// AllowMultipleì€ ìƒì†ë˜ì—ˆê¸° ë•Œë¬¸ì— ì¤‘ë³µ ì§€ì •ì— ëŒ€í•œ ErrorëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤
[DerivedAttribute]   // Error : structì— ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” Attribute 
[DerivedAttribute]   // Error : structì— ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” Attribute
public class TestClass { }
```

## ì°¸ì¡°
[ê´€ë ¨ ì½”ë“œ](https://github.com/reoul/MyCSharpTestProject)

***
<br>

    ğŸ’» ì—´ì‹¬íˆ ê³µë¶€í•´ì„œ ì‘ì„± ì¤‘ì´ë‹ˆ ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
      ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜¸


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}